(function(){"use strict";function g(u,e,o,t,s,i,c,d){var r=typeof u=="function"?u.options:u;return e&&(r.render=e,r.staticRenderFns=o,r._compiled=!0),i&&(r._scopeId="data-v-"+i),{exports:u,options:r}}const V={__name:"Item",props:{columns:Number,item:{type:Object,required:!0},line:{type:Boolean,default:!1},default:{type:Boolean,default:!0},theme:{type:String,default:"empty"},shouldToggle:{type:Boolean,default:!1},parent:{type:Boolean,default:null}},setup(u){const e=u,o=Vue.ref(e.shouldToggle),{permissions:t,updatePermissions:s}=Vue.inject("permissions"),i=Vue.computed(()=>{var n;return(n=e.item)==null?void 0:n.id}),c=Vue.computed(()=>Object.keys(r.value).length>0),d=Vue.computed(()=>e.line&&c.value),r=Vue.computed(()=>{var n;return c?(n=e.item)==null?void 0:n.childrens:[]}),m=Vue.computed(()=>{var n;return(n=e.item)==null?void 0:n.title}),p=Vue.computed(()=>Object.values(r.value).some(n=>Object.keys(n==null?void 0:n.childrens).length>0)),C=Vue.computed(()=>p.value),f=Vue.computed(()=>c.value&&!p.value?e.columns:1),L=Vue.computed(()=>t.value[i.value]);Vue.watch(e,()=>{e.shouldToggle&&(s(i.value,e.parent),c.value&&l())});function v(n){s(i.value,n)}function a(){v(!L.value),l()}function l(){o.value=!0,setTimeout(()=>{o.value=!1})}return{__sfc:!0,props:e,sendToggle:o,permissions:t,updatePermissions:s,id:i,hasChildrens:c,showAsHeader:d,childrens:r,title:m,childrenHasChildrens:p,hasLine:C,columnsToShow:f,value:L,toggle:v,invert:a,toggleChildrens:l}}};var w=function(){var e=this,o=e._self._c,t=e._self._setupProxy;return o("k-box",{staticClass:"k-patrol-item",attrs:{theme:e.theme}},[o("div",{staticClass:"k-patrol-choice",class:{"k-patrol-item-heading":t.showAsHeader}},[o("k-choice-input",{staticClass:"k-patrol-coice-input",attrs:{name:"choice",checked:t.value,label:t.title},on:{input:t.toggle}}),t.showAsHeader?o("div",[o("k-button",{attrs:{variant:"filled",size:"sm",title:e.$t("beebmx.kirby-patrol.invert-selection")},on:{click:t.invert}},[e._v(e._s(e.$t("beebmx.kirby-patrol.invert")))])],1):e._e()],1),t.hasChildrens?o("div",{staticClass:"k-patrol-childrens"},[o("k-grid",{staticStyle:{"column-gap":"var(--spacing-8)","row-gap":"var(--spacing-2)"},style:{"--columns":t.columnsToShow}},e._l(t.childrens,function(s){return o("Item",{key:s.id,attrs:{item:s,line:t.hasLine,theme:"empty",shouldToggle:t.sendToggle,columns:e.columns,parent:t.value}})}),1)],1):e._e()])},h=[],_=g(V,w,h,!1,null,"385a15b8");const b=_.exports,k={__name:"KirbyPatrolView",props:{columns:Number,content:Array,patrol:Object,role:Object,roles:Array},setup(u){const e=u,o=Vue.ref(!1),t=p(e.content),s=Vue.ref({}),i=Vue.ref({});Vue.provide("permissions",{permissions:s,updatePermissions:C});const c=Vue.computed(()=>Object.values(e.roles).map(a=>({name:a.id,label:a.title,link:`/patrol?role=${a.id}`}))),d=Vue.computed(()=>JSON.stringify(s.value)!==JSON.stringify(i.value)),r=Vue.computed(()=>!d.value||o.value),m=Vue.computed(()=>e.role.id);Vue.watchEffect(()=>{s.value=e.patrol,i.value=e.patrol}),Vue.onMounted(()=>{window.panel.events.on("view.save",v)}),Vue.onUnmounted(()=>{window.panel.events.off("view.save",v)});function p(a){return Object.values(a).map(l=>{var n;return{id:l.uri,title:((n=l==null?void 0:l.content)==null?void 0:n.title)||(l==null?void 0:l.slug),childrens:p(l.children)}})}function C(a,l){s.value={...s.value,[a]:l}}function f(){s.value=i.value}function L(){window.panel.dialog.open({component:"k-remove-dialog",props:{submitButton:{icon:"undo",text:window.panel.$t("revert")},text:window.panel.$t("revert.confirm")},on:{submit:()=>{f(),window.panel.dialog.close()}}})}async function v(a){var l;(l=a==null?void 0:a.preventDefault)==null||l.call(a),d.value&&(await window.panel.api.post(`patrol/permission/${m.value}`,{permissions:s.value})).saved&&(i.value=s.value)}return{__sfc:!0,props:e,saving:o,information:t,permissions:s,initial:i,tabs:c,isDirty:d,isDisabled:r,role:m,getContent:p,updatePermissions:C,reset:f,revert:L,save:v,Item:b}}};var y=function(){var e=this,o=e._self._c,t=e._self._setupProxy;return o("k-inside",[o("k-header",{staticClass:"k-patrol-view-header"},[e._v(" "+e._s(e.$t("beebmx.kirby-patrol.permissions"))+" "),t.isDirty?o("k-button-group",{attrs:{slot:"buttons",layout:"collapsed"},slot:"buttons"},[o("k-button",{attrs:{icon:"undo",variant:"filled",theme:"notice",size:"sm",disabled:t.isDisabled},on:{click:t.revert}},[e._v(e._s(e.$t("revert")))]),o("k-button",{attrs:{icon:"check",variant:"filled",theme:"notice",size:"sm",disabled:t.isDisabled},on:{click:t.save}},[e._v(e._s(e.$t("save")))])],1):e._e()],1),o("k-tabs",{attrs:{tab:t.role,tabs:t.tabs}}),o("k-section",[o("k-grid",{staticStyle:{gap:"var(--spacing-4)","--columns":"1"}},e._l(t.information,function(s){return o(t.Item,{key:s.id,staticStyle:{padding:"0.375rem var(--box-padding-inline)"},attrs:{item:s,line:!0,theme:"white",columns:e.columns}})}),1)],1)],1)},H=[],M=g(k,y,H,!1,null,null);const Z=M.exports;window.panel.plugin("beebmx/kirby-patrol",{components:{"k-patrol-view":Z},icons:{"patrol-shield":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3.78307 2.82598L12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598ZM5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879L5 4.60434Z"></path></svg>',"patrol-user":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3.78307 2.82598L12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598ZM5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879L5 4.60434ZM12 11C10.6193 11 9.5 9.88071 9.5 8.5C9.5 7.11929 10.6193 6 12 6C13.3807 6 14.5 7.11929 14.5 8.5C14.5 9.88071 13.3807 11 12 11ZM7.52746 16C7.77619 13.75 9.68372 12 12 12C14.3163 12 16.2238 13.75 16.4725 16H7.52746Z"></path></svg>',"patrol-keyhole":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598L12 1ZM12 3.04879L5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879ZM12 7C13.1046 7 14 7.89543 14 9C14 9.73984 13.5983 10.3858 13.0011 10.7318L13 15H11L10.9999 10.7324C10.4022 10.3866 10 9.74025 10 9C10 7.89543 10.8954 7 12 7Z"></path></svg>',"patrol-flash":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3.78307 2.82598L12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598ZM5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879L5 4.60434ZM13 10H16L11 17V12H8L13 5V10Z"></path></svg>',"patrol-star":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 4.60434V13.7889C5 15.1263 5.6684 16.3752 6.7812 17.1171L12 20.5963L17.2188 17.1171C18.3316 16.3752 19 15.1263 19 13.7889V4.60434L12 3.04879L5 4.60434ZM3.78307 2.82598L12 1L20.2169 2.82598C20.6745 2.92766 21 3.33347 21 3.80217V13.7889C21 15.795 19.9974 17.6684 18.3282 18.7812L12 23L5.6718 18.7812C4.00261 17.6684 3 15.795 3 13.7889V3.80217C3 3.33347 3.32553 2.92766 3.78307 2.82598ZM12 13.5L9.06107 15.0451L9.62236 11.7725L7.24472 9.45492L10.5305 8.97746L12 6L13.4695 8.97746L16.7553 9.45492L14.3776 11.7725L14.9389 15.0451L12 13.5Z"></path></svg>',"patrol-siren":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.00001 20V14C4.00001 9.58172 7.58173 6 12 6C16.4183 6 20 9.58172 20 14V20H21V22H3.00001V20H4.00001ZM6.00001 20H18V14C18 10.6863 15.3137 8 12 8C8.6863 8 6.00001 10.6863 6.00001 14V20ZM11 2H13V5H11V2ZM19.7782 4.80761L21.1924 6.22183L19.0711 8.34315L17.6569 6.92893L19.7782 4.80761ZM2.80762 6.22183L4.22183 4.80761L6.34315 6.92893L4.92894 8.34315L2.80762 6.22183ZM7.00001 14C7.00001 11.2386 9.23858 9 12 9V11C10.3432 11 9.00001 12.3431 9.00001 14H7.00001Z"></path></svg>',"patrol-police":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 13V18H20V13H4ZM5.61803 11H18.382C18.5372 11 18.6903 10.9639 18.8292 10.8944C19.3232 10.6474 19.5234 10.0468 19.2764 9.55279L18 7H6L4.72361 9.55279C4.65418 9.69164 4.61803 9.84475 4.61803 10C4.61803 10.5523 5.06575 11 5.61803 11ZM22 13.5V21C22 21.5523 21.5523 22 21 22H20C19.4477 22 19 21.5523 19 21V20H5V21C5 21.5523 4.55228 22 4 22H3C2.44772 22 2 21.5523 2 21V13.5L0.757464 13.1894C0.312297 13.0781 0 12.6781 0 12.2192V11.5C0 11.2239 0.223858 11 0.5 11H2L4.44721 6.10557C4.786 5.428 5.47852 5 6.23607 5H8V3H11V5H13V3H16V5H17.7639C18.5215 5 19.214 5.428 19.5528 6.10557L22 11H23.5C23.7761 11 24 11.2239 24 11.5V12.2192C24 12.6781 23.6877 13.0781 23.2425 13.1894L22 13.5ZM5 14C7.31672 14 8.87868 14.7548 9.68588 16.2643L9.68582 16.2643C9.81602 16.5078 9.72418 16.8107 9.4807 16.9409C9.40818 16.9797 9.3272 17 9.24496 17H6C5.44772 17 5 16.5523 5 16V14ZM19 14V16C19 16.5523 18.5523 17 18 17H14.755C14.6728 17 14.5918 16.9797 14.5193 16.9409C14.2758 16.8107 14.184 16.5078 14.3142 16.2643L14.3141 16.2643C15.1213 14.7548 16.6833 14 19 14Z"></path></svg>'}})})();
